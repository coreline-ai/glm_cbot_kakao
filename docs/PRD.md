# 코비서 AI 봇 - 제품 요구 사항 문서 (PRD)

## 📋 문서 정보

- **문서 버전**: 1.0.0
- **작성일**: 2026-02-05
- **작성자**: AI 팀
- **최종 수정일**: 2026-02-05
- **상태**: Draft

## 🎯 제품 개요

### 1.1 제품명
코비서 (Kobiserv) - GLM-4 기반 카카오톡 AI 봇

### 1.2 제품 설명
"코비서"는 GLM-4 AI 엔진을 활용하여 카카오톡 메시지에 지능적으로 반응하는 미니멀한 AI 봇 백엔드입니다. 사용자가 "코비서"라는 호출어와 함께 질문하면, 자연스러운 한국어로 답변을 생성하여 대화 경험을 향상시킵니다.

### 1.3 타겟 사용자
- **주요 사용자**: 카카오톡 사용자
- **보조 사용자**: 개발자, 테스트 엔지니어
- **사용 시나리오**: 일상 대화, 정보 조회, 간단한 질문 응답

## 🚀 제품 기능

### 2.1 핵심 기능

#### 2.1.1 AI 대화 시스템
- **호출어 기반 활성화**: "코비서" 호출어 감지 및 반응
- **GLM-4 API 통합**: 최신 AI 모델을 통한 자연스러운 응답 생성
- **다국어 지원**: 한국어 우선, 다른 언어 추가 가능성
- **응답 제한**: 3문장 이내의 간결한 답변 생성

#### 2.1.2 메시지 처리
- **실시간 메시지 분석**: 입력 메시지의 호출어 여부 확인
- **쿼리 추출**: 호출어 이후의 질문 내용 분리
- **응답 생성**: AI 모델을 통한 적절한 답변 생성
- **결과 반환**: JSON 형식의 응답 데이터 반환

#### 2.1.3 로그 시스템
- **실시간 모니터링**: 서버 실행 시 데이터 흐름 로그 출력
- **세부 정보 제공**: API 요청/응답, 분석 결과, 오류 정보
- **포맷된 출력**: 가독성 높은 로그 형식

#### 2.1.4 통신 기능
- **CORS 지원**: 다양한 클라이언트 환경에서 접속 가능
- **에뮬레이터 통신**: Android 에뮬레이터와 호스트 PC 간 안정적인 통신
- **전용 IP 사용**: 10.0.2.2를 통한 에뮬레이터 연결

### 2.2 보조 기능

#### 2.2.1 서버 관리
- **상태 확인 API**: 서버 동작 상태 확인
- **포트 설정**: 환경 변수를 통한 포트 번호 조정
- **개발 모드 지원**: Hot Reload 기능

#### 2.2.2 확장성
- **모듈화 아키텍처**: 향후 기능 추가 용이
- **설정 관리**: 환경 변수를 통한 유연한 설정
- **API 확장 가능성**: 추가 엔드포인트 구현 용이

## 🏗️ 시스템 아키텍처

### 3.1 기술 스택
- **백엔드**: NestJS, TypeScript
- **AI 엔진**: GLM-4 API (z.ai)
- **HTTP 클라이언트**: Axios
- **데이터 형식**: JSON
- **데이터베이스**: 미니멀 아키텍처 (데이터베이스 없음)

### 3.2 컴포넌트 구조

```
src/main.ts
├── ChatService       # AI 통신 및 메시지 처리 로직
├── AppController     # API 엔드포인트 정의
└── AppModule        # 애플리케이션 모듈
```

### 3.3 데이터 흐름

```
사용자 입력 → 호출어 감지 → GLM-4 API 호출 → AI 응답 생성 → 결과 반환
```

## 📡 API 명세

### 4.1 엔드포인트

#### 4.1.1 상태 확인
```
GET /
```
- **설명**: 서버 상태 확인
- **응답**:
```json
{
  "status": "ok",
  "message": "코비서 AI 서버 작동 중",
  "version": "1.0.0"
}
```

#### 4.1.2 메시지 처리
```
POST /chat/process
Content-Type: application/json

{
  "message": "코비서, 오늘 날씨 어때?"
}
```
- **설명**: 메시지 분석 및 AI 응답 생성
- **응답**:
```json
{
  "summary": "오늘 서울의 날씨는 맑고 따뜻합니다. 오후에는 25도까지 올라갈 예정이니 가벼운 옷차림이 좋겠네요."
}
```


## ⚙️ 설정 요구사항

### 5.1 환경 변수

| 변수명 | 설명 | 기본값 | 필수 여부 |
|--------|------|--------|----------|
| `GLM_API_KEY` | GLM API 인증 키 | - | ✅ |
| `GLM_BASE_URL` | GLM API 기본 URL | `https://api.z.ai/api/coding/paas/v4` | ⚠️ |
| `GLM_MODEL` | 사용할 GLM 모델 | `GLM-4-Plus` | ⚠️ |
| `GLM_TEMPERATURE` | 응답의 창의성 정도 (0-1) | `0.2` | ⚠️ |
| `PORT` | 서버 포트 번호 | `3001` | ⚠️ |
| `LOG_LEVEL` | 로그 레벨 | `info` | ⚠️ |

### 5.2 하드웨어 요구사항
- **서버**: 최소 2GB RAM, 1CPU 코어
- **네트워크**: 안정적인 인터넷 연결
- **저장 공간**: 최소 100MB

### 5.3 소프트웨어 요구사항
- **Node.js**: 18.x 이상
- **npm**: 8.x 이상
- **GLM API**: z.ai 계정 및 API 키

## 📊 로그 시스템

### 6.1 로그 출력 형식

```
┌── [AI API Request] ──────────────────────────
│ Model: GLM-4-Plus
│ Messages: [{"role":"user","content":"너는 '코비서'라는 이름의 친절한 AI 비서야. 한국어로 자연스럽게 간결하게(3문장 이내) 답변해줘. 사용자 질문: \"오늘 날씨 어때?\""}]
└──────────────────────────────────────────────

🔍 [Analysis]: 호출어 감지됨 -> 쿼리: "오늘 날씨 어때?"

┌── [AI API Response] ─────────────────────────
│ Content: 오늘 서울의 날씨는 맑고 따뜻합니다. 오후에는 25도까지 올라갈 예정이니 가벼운 옷차림이 좋겠네요.
└──────────────────────────────────────────────
```

### 6.2 로그 종류

| 로그 유형 | 설명 | 출력 예시 |
|----------|------|----------|
| **AI API Request** | GLM-4 API 호출 정보 | 모델, 메시지 내용 |
| **AI API Response** | AI 응답 결과 | 생성된 응답 내용 |
| **Analysis** | 메시지 분석 결과 | 호출어 감지, 쿼리 내용 |
| **Error** | API 오류 정보 | 오류 메시지 |

## 📱 클라이언트 연동

### 7.1 Android 에뮬레이터 통신
- **전용 IP**: 10.0.2.2 사용
- **연결 방식**: HTTP 요청을 통한 서버 접속
- **CORS 설정**: 모든 출처 허용

### 7.2 클라이언트 요구사항
- **네트워크 권한**: 인터넷 접근 권한
- **HTTP 클라이언트**: Axios 또는 유사 라이브러리
- **JSON 파싱**: 응답 데이터 처리 기능

## 🧪 테스트 전략

### 8.1 테스트 종류
- **단위 테스트**: 각 컴포넌트별 기능 테스트
- **통합 테스트**: API 엔드포인트 통합 테스트
- **통신 테스트**: 에뮬레이터와의 연동 테스트
- **성능 테스트**: 응답 시간 및 처리량 테스트

### 8.2 테스트 환경
- **개발 환경**: 로컬 개발 머신
- **테스트 환경**: 안드로이드 에뮬레이터
- **프로덕션 환경**: 실제 서버 배포

## 📈 성능 요구사항

### 9.1 응답 시간
- **목표**: 2초 이내 응답
- **최대**: 5초 이내 응답

### 9.2 처리량
- **목표**: 분당 60회 요청 처리
- **최대**: 분당 100회 요청 처리

### 9.3 가용성
- **목표**: 99.9% 가용성
- **장애 대응**: 자동 재시작 메커니즘

## 📝 기술 문서

### 10.1 개발 가이드
- [README.md](../README.md): 프로젝트 설명 및 설치 방법
- 코드 구조 설명: 주요 클래스 및 모듈
- 설정 방법: 환경 변수 및 구성

### 10.2 사용자 문서
- 설치 및 실행 가이드
- API 사용 방법
- 문제 해결 가이드

## 📅 릴리스 계획

### 11.1 버전 1.0.0 (현재)
- **기능**: 핵심 AI 대화 시스템
- **기능**: 로그 시스템
- **기능**: 기본 API 엔드포인트

### 11.2 버전 1.1.0 (계획)
- **기능**: 채팅 기록 저장 시스템
- **기능**: 사용자 인증 시스템
- **기능**: 다국어 지원 확장

### 11.3 버전 1.2.0 (계획)
- **기능**: 고급 분석 기능
- **기능**: 알림 시스템
- **기능**: 모바일 앱 연동

### 11.4 Android 클라이언트 개발
- **앱 아키텍처**: Clean Architecture (Domain, Data, Presentation 레이어)
- **UI 디자인**: Terminal UI (해커 감성의 블랙 & 그린 테마)
- **핵심 기능**: 실시간 알림 처리, 네트워크 안정성, 자동 응답 생성
- **기술 스택**: Kotlin, Retrofit, Coroutines
- **주요 컴포넌트**: MyNotificationService, RetrofitClient, UI 레이어

### 11.5 버전 1.3.0 (계획)
- **기능**: 실시간 알림 처리
- **기능**: 다중 장치 지원
- **기능**: 고급 사용자 인터페이스